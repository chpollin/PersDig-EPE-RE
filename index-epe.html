<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>EPE - Edition Production Environment</title>
   <link rel="stylesheet" href="style.css">
</head>
<body>
   <!-- Header -->
   <header class="main-header">
       <div class="header-left">
           <div class="logo">
               <span class="logo-text">EPE</span>
               <span class="logo-subtitle">Edition Production Environment v0.1-alpha</span>
           </div>
           <nav class="main-nav">
               <a href="#" class="nav-item active" id="nav-workspace">Workspace</a>
               <a href="#" class="nav-item" id="nav-import">Import Hub</a>
               <a href="#" class="nav-item" id="nav-models">Models</a>
               <a href="#" class="nav-item" id="nav-export">Export</a>
               <a href="#" class="nav-item" id="nav-api">API</a>
               <a href="#" class="nav-item" id="nav-settings">Settings</a>
           </nav>
       </div>
       <div class="header-right">
           <div class="connection-indicator">
               <span class="indicator-dot online"></span>
               <span id="connection-text">eScriptorium Connected</span>
           </div>
           <select class="language-switcher" id="language-switch">
               <option value="EN">EN</option>
               <option value="FA">FA</option>
               <option value="AR">AR</option>
               <option value="TR">TR</option>
               <option value="UR">UR</option>
           </select>
           <span class="user-info">user@institution.edu</span>
           <button class="btn-logout">Logout</button>
       </div>
   </header>

   <!-- Main Container -->
   <div class="app-container">
       
       <!-- Left Sidebar - Witness Manager -->
       <aside class="sidebar">
           <div class="project-header">
               <h3>PROJECT METADATA</h3>
               <span class="project-name" id="project-name">Persian Digital Humanities Collection</span>
               <div class="project-stats">
                   <span id="project-type">Type: Multi-witness Edition</span>
                   <span id="project-schema">Schema: SQE Compatible</span>
               </div>
           </div>
           
           <!-- Witness Navigator -->
           <div class="witness-panel">
               <div class="panel-header">
                   <h4>Witnesses</h4>
                   <div class="witness-controls">
                       <button class="btn-icon" id="btn-import-witness" title="Import from eScriptorium">‚¨á</button>
                       <button class="btn-icon" id="btn-add-witness" title="Add Witness">+</button>
                       <button class="btn-icon" id="btn-batch-ops" title="Batch Operations">‚ãÆ</button>
                   </div>
               </div>
               
               <div class="witness-overview">
                   <div class="witness-counter">
                       <div class="counter-item">
                           <span class="counter-number" id="total-witnesses">60</span>
                           <span class="counter-label">TOTAL<br>WITNESSES</span>
                       </div>
                       <div class="counter-item">
                           <span class="counter-number" id="total-tokens">245,892</span>
                           <span class="counter-label">ALIGNED<br>TOKENS</span>
                       </div>
                       <div class="counter-item">
                           <span class="counter-number" id="active-witnesses">12</span>
                           <span class="counter-label">ACTIVE</span>
                       </div>
                   </div>
               </div>

               <div class="witness-filters">
                   <input type="text" class="witness-search" id="witness-search" placeholder="Search witnesses...">
                   <select class="witness-filter" id="witness-filter">
                       <option>All Witnesses</option>
                       <option>With Transcription</option>
                       <option>Aligned</option>
                       <option>Needs Review</option>
                   </select>
               </div>
               
               <!-- Witness List -->
               <div class="witness-list-container">
                   <div class="witness-list" id="witness-list">
                       <!-- Dynamic content will be loaded here -->
                       <div class="witness-group base-text">
                           <div class="witness-item selected base">
                               <input type="checkbox" checked>
                               <span class="witness-status aligned"></span>
                               <div class="witness-info">
                                   <span class="witness-id">MS_001</span>
                                   <span class="witness-label">Paris BnF Persan 1234 [BASE]</span>
                                   <div class="witness-meta">
                                       <span>1453 CE</span>
                                       <span>156 folios</span>
                                       <span>Complete</span>
                                   </div>
                               </div>
                               <button class="btn-witness-action">‚öô</button>
                           </div>
                       </div>

                       <div class="witness-group expanded">
                           <div class="witness-group-header">
                               <span class="expand-icon">‚ñº</span>
                               <span>Primary Witnesses (12)</span>
                               <span class="group-status">11 aligned</span>
                           </div>
                           <div class="witness-items">
                               <div class="witness-item">
                                   <input type="checkbox" checked>
                                   <span class="witness-status aligned"></span>
                                   <div class="witness-info">
                                       <span class="witness-id">MS_002</span>
                                       <span class="witness-label">Oxford Bodl. Pers. 567</span>
                                       <div class="witness-meta">
                                           <span>1498 CE</span>
                                           <span>143 folios</span>
                                           <span dir="rtl">ŸÜÿ≥ÿÆŸá ⁄©ÿßŸÖŸÑ</span>
                                       </div>
                                   </div>
                               </div>
                           </div>
                       </div>

                       <div class="witness-group collapsed">
                           <div class="witness-group-header">
                               <span class="expand-icon">‚ñ∂</span>
                               <span>Secondary Witnesses (48)</span>
                               <span class="group-status">35 aligned</span>
                           </div>
                       </div>
                   </div>
               </div>

               <!-- Bottom Actions -->
               <div class="sidebar-actions">
                   <button class="btn-secondary" id="btn-import-witnesses">Import Witnesses</button>
                   <button class="btn-secondary" id="btn-batch-actions">Batch Actions</button>
               </div>

               <!-- Alignment Matrix -->
               <div class="alignment-matrix-preview">
                   <h5>ALIGNMENT COVERAGE</h5>
                   <div class="matrix-heatmap" id="matrix-heatmap">
                       <!-- Dynamic heatmap will be rendered here -->
                   </div>
                   <button class="btn-secondary" id="btn-open-matrix">Open Alignment Matrix</button>
               </div>
           </div>
       </aside>

       <!-- Main Workspace -->
       <main class="workspace">
           <!-- Workspace Tabs -->
           <div class="workspace-tabs">
               <button class="tab-btn" data-tab="import">Import</button>
               <button class="tab-btn" data-tab="segmentation">Segmentation</button>
               <button class="tab-btn active" data-tab="alignment">Alignment</button>
               <button class="tab-btn" data-tab="annotation">Annotation</button>
               <button class="tab-btn" data-tab="collation">Collation</button>
               <button class="tab-btn" data-tab="preview">Preview TEI</button>
           </div>

           <!-- Context Bar -->
           <div class="context-bar">
               <div class="breadcrumb" id="breadcrumb">
                   <span>Project</span>
                   <span>‚Ä∫</span>
                   <span>All Witnesses</span>
                   <span>‚Ä∫</span>
                   <span>Alignment View</span>
               </div>
               <div class="workflow-status">
                   <span class="status-step complete" id="status-import">Import ‚úì</span>
                   <span class="status-step complete" id="status-tokenize">Tokenize ‚úì</span>
                   <span class="status-step active" id="status-align">Align</span>
                   <span class="status-step" id="status-annotate">Annotate</span>
                   <span class="status-step" id="status-export">Export</span>
               </div>
           </div>

           <!-- Toolbar -->
           <div class="toolbar">
               <div class="toolbar-group">
                   <button class="tool-btn" id="btn-zoom-in" title="Zoom In">üîç+</button>
                   <button class="tool-btn" id="btn-zoom-out" title="Zoom Out">üîç-</button>
                   <span class="zoom-level" id="zoom-level">100%</span>
               </div>
               <div class="toolbar-group">
                   <button class="tool-btn" id="btn-prev-var" title="Previous Variation">‚óÄ</button>
                   <button class="tool-btn" id="btn-next-var" title="Next Variation">‚ñ∂</button>
                   <span class="variation-counter">Var. 1/1</span>
               </div>
               <div class="toolbar-group">
                   <select class="view-mode" id="view-mode">
                       <option>Parallel View</option>
                       <option>Synopsis</option>
                       <option>Apparatus</option>
                       <option>Image-Text</option>
                   </select>
                   <select class="granularity" id="granularity">
                       <option value="token">Token</option>
                       <option value="line">Line</option>
                       <option value="section">Section</option>
                       <option value="page">Page</option>
                   </select>
               </div>
               <div class="toolbar-group">
                   <button class="tool-btn" id="btn-retokenize" title="Retokenize">üîÑ</button>
                   <button class="tool-btn" id="btn-save" title="Save Project">üíæ</button>
               </div>
           </div>

           <!-- Main Content Area -->
           <div class="parallel-view-container">
               <!-- Manuscript Image Panel -->
               <div class="panel iiif-viewer">
                   <div class="panel-header">
                       <span id="image-title">MS_001 - Folio 42r (IIIF)</span>
                       <div class="panel-controls">
                           <button class="btn-small" id="btn-prev-page">Previous</button>
                           <span id="page-counter">42 / 156</span>
                           <button class="btn-small" id="btn-next-page">Next</button>
                       </div>
                   </div>
                   <div class="iiif-container">
                       <div class="manuscript-viewer" id="manuscript-viewer">
                           <div class="manuscript-page">
                               <!-- Simulated manuscript page -->
                               <div class="text-region">
                                   <div class="text-line">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</div>
                                   <div class="text-line">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</div>
                                   <div class="text-line">‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</div>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>

               <!-- Alignment Table Panel -->
               <div class="panel alignment-grid">
                   <div class="panel-header">
                       <span>Multi-Witness Alignment</span>
                       <div class="panel-controls">
                           <label><input type="checkbox" id="show-variants" checked> Show variants</label>
                           <label><input type="checkbox" id="normalize"> Normalize</label>
                           <button class="btn-small" id="btn-export-collatex">Export CollateX</button>
                       </div>
                   </div>
                   
                   <div class="alignment-table-container">
                       <table class="alignment-table" id="alignment-table">
                           <thead>
                               <tr>
                                   <th class="witness-header">WITNESS</th>
                                   <th class="token-header">TOKEN 1</th>
                                   <th class="token-header">TOKEN 2</th>
                                   <th class="token-header">TOKEN 3</th>
                                   <th class="token-header variant">TOKEN 4 ‚ö†</th>
                                   <th class="token-header">TOKEN 5</th>
                               </tr>
                           </thead>
                           <tbody id="alignment-tbody">
                               <!-- Dynamic content -->
                           </tbody>
                       </table>
                   </div>

                   <!-- Apparatus -->
                   <div class="apparatus-view" id="apparatus-view">
                       <h5>CRITICAL APPARATUS</h5>
                       <div id="apparatus-content">
                           <!-- Dynamic apparatus entries -->
                       </div>
                   </div>
               </div>
           </div>

           <!-- Token Detail Panel -->
           <div class="token-detail-panel" id="token-detail-panel">
               <div class="detail-header">
                   <h4>Token Details</h4>
                   <span class="token-id" id="token-id">Token ID: ‚Äî</span>
               </div>
               <div class="detail-content">
                   <div class="detail-group">
                       <label>Diplomatic:</label>
                       <input type="text" id="token-diplomatic" class="detail-input" dir="auto">
                   </div>
                   <div class="detail-group">
                       <label>Normalized:</label>
                       <input type="text" id="token-normalized" class="detail-input" dir="auto">
                   </div>
                   <div class="detail-group">
                       <label>Variants:</label>
                       <div class="variant-list" id="variant-list">
                           <!-- Dynamic variants -->
                       </div>
                   </div>
                   <div class="detail-group">
                       <label>Annotations:</label>
                       <div class="annotation-tags" id="annotation-tags">
                           <!-- Dynamic annotations -->
                       </div>
                       <button class="btn-add-tag" id="btn-add-annotation">+</button>
                   </div>
               </div>
           </div>
       </main>

       <!-- Right Panel -->
       <aside class="right-panel">
           <!-- Context Tools -->
           <div class="panel-section">
               <h4>CONTEXT TOOLS</h4>
               <div class="tool-palette">
                   <button class="palette-btn" id="btn-auto-align">Auto-align Selected</button>
                   <button class="palette-btn" id="btn-merge-tokens">Merge Tokens</button>
                   <button class="palette-btn" id="btn-split-token">Split Token</button>
                   <button class="palette-btn" id="btn-validate">Validate Page</button>
               </div>
           </div>

           <!-- Quick Actions -->
           <div class="panel-section">
               <h4>QUICK EXPORT</h4>
               <div class="export-options">
                   <button class="export-btn" data-format="txt">
                       <span class="format">TXT</span>
                       <span class="description">Plain Text</span>
                   </button>
                   <button class="export-btn" data-format="json">
                       <span class="format">JSON</span>
                       <span class="description">CollateX</span>
                   </button>
                   <button class="export-btn" data-format="html">
                       <span class="format">HTML</span>
                       <span class="description">Report</span>
                   </button>
                   <button class="export-btn" data-format="csv">
                       <span class="format">CSV</span>
                       <span class="description">Table</span>
                   </button>
                   <button class="export-btn" data-format="tei-basic">
                       <span class="format">TEI</span>
                       <span class="description">Basic XML</span>
                   </button>
                   <button class="export-btn" data-format="alto">
                       <span class="format">ALTO</span>
                       <span class="description">With Images</span>
                   </button>
               </div>
           </div>

           <!-- Processing Queue -->
           <div class="panel-section">
               <h4>PROCESSING QUEUE</h4>
               <div class="activity-monitor">
                   <div class="process-item" id="process-status">
                       <span class="process-icon">‚úì</span>
                       <div class="process-info">
                           <span class="process-name">Ready</span>
                           <span class="process-status">No active processes</span>
                       </div>
                   </div>
               </div>
           </div>

           <!-- Annotation Sets -->
           <div class="panel-section">
               <h4>ANNOTATION SETS</h4>
               <div class="annotation-sets">
                   <label><input type="checkbox" id="anno-linguistic" checked> Linguistic</label>
                   <label><input type="checkbox" id="anno-structural" checked> Structural</label>
                   <label><input type="checkbox" id="anno-intertextual"> Intertextual</label>
                   <label><input type="checkbox" id="anno-scribal"> Scribal Hands</label>
                   <label><input type="checkbox" id="anno-entities"> Named Entities</label>
               </div>
           </div>
       </aside>
   </div>

   <!-- Bottom Bar -->
   <footer class="bottom-bar">
       <div class="progress-section">
           <span>Alignment Progress:</span>
           <div class="progress-bar">
               <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
           </div>
           <span id="progress-percent">0%</span>
       </div>
       
       <div class="console-toggle">
           <button class="btn-console" id="btn-console">Console ‚ñ≤</button>
       </div>
       
       <div class="status-section">
           <span class="status-message" id="status-message">‚úì Ready</span>
           <span class="connection-status" id="connection-status">‚óè Connected</span>
       </div>
   </footer>

   <!-- Console Panel -->
   <div class="console-panel hidden" id="console-panel">
       <div class="console-header">
           <span>Activity Log</span>
           <button class="btn-close-console" id="btn-close-console">√ó</button>
       </div>
       <div class="console-content" id="console-content">
           <div class="log-entry info">EPE initialized. Ready to load project.</div>
       </div>
   </div>

   <!-- Floating Action Button -->
   <div class="fab-container">
       <button class="fab main-fab" id="fab-main">+</button>
       <div class="fab-menu hidden" id="fab-menu">
           <button class="fab mini-fab" id="fab-import" title="Load Sample">üìÅ</button>
           <button class="fab mini-fab" id="fab-tokenize" title="Tokenize">üî§</button>
           <button class="fab mini-fab" id="fab-save" title="Save">üíæ</button>
           <button class="fab mini-fab" id="fab-help" title="Help">?</button>
       </div>
   </div>

   <!-- Load JavaScript -->
   <script src="data.js"></script>
   
   <!-- Initialize after DOM load -->
   <script>
       // Quick initialization for immediate functionality
       document.addEventListener('DOMContentLoaded', function() {
           // Connect Import Hub button
           document.getElementById('nav-import').addEventListener('click', function(e) {
               e.preventDefault();
               if (typeof showSampleProjectMenu === 'function') {
                   showSampleProjectMenu();
               }
           });
           
           // Connect Export button
           document.getElementById('nav-export').addEventListener('click', function(e) {
               e.preventDefault();
               if (EPE && EPE.ui && EPE.ui.showExportDialog) {
                   EPE.ui.showExportDialog();
               }
           });
           
           // Connect Settings button
           document.getElementById('nav-settings').addEventListener('click', function(e) {
               e.preventDefault();
               if (confirm('Export localStorage backup?')) {
                   if (EPE && EPE.storage && EPE.storage.exportLocalStorage) {
                       EPE.storage.exportLocalStorage();
                   }
               }
           });
           
           // Connect Console button
           document.getElementById('btn-console').addEventListener('click', function() {
               document.getElementById('console-panel').classList.toggle('hidden');
           });
           
           // Connect Console close button
           document.getElementById('btn-close-console').addEventListener('click', function() {
               document.getElementById('console-panel').classList.add('hidden');
           });
           
           // Connect FAB
           document.getElementById('fab-main').addEventListener('click', function() {
               document.getElementById('fab-menu').classList.toggle('hidden');
           });
           
           // Connect FAB buttons
           document.getElementById('fab-import').addEventListener('click', function() {
               if (typeof showSampleProjectMenu === 'function') {
                   showSampleProjectMenu();
                   document.getElementById('fab-menu').classList.add('hidden');
               }
           });
           
           document.getElementById('fab-save').addEventListener('click', function() {
               if (EPE && EPE.storage && EPE.storage.saveProject) {
                   EPE.storage.saveProject();
                   document.getElementById('fab-menu').classList.add('hidden');
               }
           });
           
           // Connect Export buttons
           document.querySelectorAll('.export-btn').forEach(btn => {
               btn.addEventListener('click', function(e) {
                   const format = this.dataset.format;
                   if (EPE && EPE.exporters) {
                       EPE.exporters.exportProject(format, {
                           includeText: true,
                           includeTokens: true,
                           includeApparatus: true
                       });
                   }
               });
           });
           
           // Log ready state
           console.log('EPE Interface Ready - Use Import Hub to load sample project');
       });
   </script>
</body>
</html>